From f4ba0fda325461178d028174edf58545b86adab9 Mon Sep 17 00:00:00 2001
From: Andrew Bayer <andrew.bayer@gmail.com>
Date: Thu, 27 Jan 2011 15:36:08 -0800
Subject: [PATCH 02/51] CLOUDERA-BUILD. Support CDH Mavenization.

---
 build-common.xml                                   |   14 ++-
 build.xml                                          |   12 ++-
 cli/ivy.xml                                        |    8 +-
 cloudera-pom.xml                                   |  184 ++++++++++++++++++++
 cloudera/do-release-build                          |    7 +
 cloudera/maven-packaging/hive-anttasks/pom.xml     |   76 ++++++++
 cloudera/maven-packaging/hive-cli/pom.xml          |  112 ++++++++++++
 cloudera/maven-packaging/hive-common/pom.xml       |  176 +++++++++++++++++++
 cloudera/maven-packaging/hive-contrib/pom.xml      |   76 ++++++++
 cloudera/maven-packaging/hive-exec/pom.xml         |   76 ++++++++
 cloudera/maven-packaging/hive-hwi/pom.xml          |   76 ++++++++
 cloudera/maven-packaging/hive-jdbc/pom.xml         |   76 ++++++++
 cloudera/maven-packaging/hive-metastore/pom.xml    |   77 ++++++++
 cloudera/maven-packaging/hive-serde/pom.xml        |   76 ++++++++
 cloudera/maven-packaging/hive-service/pom.xml      |   76 ++++++++
 cloudera/maven-packaging/hive-shims/pom.xml        |   76 ++++++++
 cloudera/maven-packaging/pom.xml                   |   80 +++++++++
 .../maven-packaging/templates/cdh.build.template   |    6 +
 .../maven-packaging/templates/libraries.template   |   36 ++++
 common/ivy.xml                                     |    4 +-
 contrib/ivy.xml                                    |    4 +-
 hbase-handler/ivy.xml                              |    4 +-
 hwi/ivy.xml                                        |    4 +-
 ivy/ivysettings.xml                                |   15 ++
 metastore/ivy.xml                                  |    4 +-
 ql/ivy.xml                                         |    4 +-
 serde/ivy.xml                                      |    4 +-
 shims/build.xml                                    |    2 +-
 shims/ivy.xml                                      |    5 +-
 29 files changed, 1345 insertions(+), 25 deletions(-)
 create mode 100644 cloudera-pom.xml
 create mode 100644 cloudera/maven-packaging/hive-anttasks/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-cli/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-common/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-contrib/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-exec/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-hwi/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-jdbc/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-metastore/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-serde/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-service/pom.xml
 create mode 100644 cloudera/maven-packaging/hive-shims/pom.xml
 create mode 100644 cloudera/maven-packaging/pom.xml
 create mode 100644 cloudera/maven-packaging/templates/cdh.build.template
 create mode 100644 cloudera/maven-packaging/templates/libraries.template

diff --git a/build-common.xml b/build-common.xml
index d115b45..07dcd36 100644
--- a/build-common.xml
+++ b/build-common.xml
@@ -23,6 +23,7 @@
          name="hivecommon" default="jar">
 
   <property name="hive.root" location="${basedir}/.."/>
+  <property file="${hive.root}/cdh.build.properties"/>
   <property file="${hive.root}/build.properties"/>
   <property file="${user.home}/build.properties" />
   <property file="${basedir}/build.properties" />
@@ -124,7 +125,16 @@
     </condition>
   </target>
 
-  <target name="ivy-download" depends="ivy-init-dirs"
+  <!-- Initializes ivy/libraries.properties and build.properties with CDH versions -->
+  <target name="init-cdh" unless="cdh.maven">
+    <exec executable="mvn" dir="${hive.root}" failonerror="true">
+      <arg value="-f" />
+      <arg value="cloudera-pom.xml" />
+      <arg value="process-resources"/>
+    </exec>
+  </target>
+
+  <target name="ivy-download" depends="ivy-init-dirs,init-cdh"
           description="To download ivy" unless="offline">
     <get src="${ivy_repo_url}" dest="${ivy.jar}" usetimestamp="true"/>
   </target>
@@ -203,7 +213,7 @@
   <target name="ivy-retrieve-hadoop-source" depends="ivy-init"
     description="Retrieve Ivy-managed Hadoop source artifacts" unless="ivy.skip">
     <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
-      pattern="${build.dir.hadoop}/[artifact]-[revision].[ext]"/>
+      pattern="${build.dir.hadoop}/hadoop-[revision].[ext]"/>
   </target>
 
   <target name="ivy-docs" depends="ivy-init"
diff --git a/build.xml b/build.xml
index 98fabab..5b77be0 100644
--- a/build.xml
+++ b/build.xml
@@ -21,6 +21,7 @@
 <project name="hive" default="jar" xmlns:artifact="urn:maven-artifact-ant" >
 
   <property name="hive.root" location="${basedir}"/>
+  <property file="${hive.root}/cdh.build.properties"/>
   <property file="${hive.root}/build.properties"/>
   <property file="${user.home}/build.properties" />
   <property file="${basedir}/build.properties" />
@@ -160,7 +161,16 @@
     <path refid="common-classpath"/>
   </path>
 
-  <target name="init">
+  <!-- Initializes ivy/libraries.properties and build.properties with CDH versions -->
+  <target  name="init-cdh" unless="cdh.maven">
+    <exec  executable="mvn" dir="${basedir}" failonerror="true">
+      <arg value="-f" />
+      <arg value="cloudera-pom.xml" />
+      <arg value="process-resources"/>
+    </exec>
+  </target>
+
+  <target name="init" depends="init-cdh">
     <iterate-all target="init"/>
   </target>
 
diff --git a/cli/ivy.xml b/cli/ivy.xml
index f272b91..687bd17 100644
--- a/cli/ivy.xml
+++ b/cli/ivy.xml
@@ -24,9 +24,9 @@
       </description>
     </info>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
+      <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+        <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
+      </dependency>
+      <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
     </dependencies>
 </ivy-module>
diff --git a/cloudera-pom.xml b/cloudera-pom.xml
new file mode 100644
index 0000000..183403c
--- /dev/null
+++ b/cloudera-pom.xml
@@ -0,0 +1,184 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+<project>
+    <modelVersion>4.0.0</modelVersion>
+
+    <parent>
+        <groupId>com.cloudera.cdh</groupId>
+        <artifactId>hive-root</artifactId>
+        <version>3.0-beta-4-SNAPSHOT</version>
+    </parent>
+
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-ant</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+    <packaging>pom</packaging>
+
+    <scm>
+        <connection>scm:git:git@git.sf.cloudera.com:hive.git</connection>
+        <url>git@git.sf.cloudera.com:hive.git</url>
+    </scm>
+
+    <description>Hive ant</description>
+    <name>Hive ant</name>
+
+    <licenses>
+        <license>
+            <name>The Apache Software License, Version 2.0</name>
+            <url>http://www.apache.org/licenses/LICENSE-2.0.txt</url>
+        </license>
+    </licenses>
+
+    <organization>
+        <name>Cloudera</name>
+        <url>http://www.cloudera.com</url>
+    </organization>
+
+      <profiles>
+    <!--To allow standalone project to fetch CDH artifacts -->
+    <!--Activate by default doing a negation of negation   -->
+    <!-- this trick allows CDH root to switch it off       -->
+    <profile>
+      <id>cdh.repos</id>
+      <activation>
+        <activeByDefault>false</activeByDefault>
+        <property>
+          <name>use.cdh.repos</name>
+          <value>!false</value>
+        </property>
+      </activation>
+      <repositories>
+        <repository>
+          <id>cdh.releases.repo</id>
+          <url>https://repository.cloudera.com/content/repositories/releases</url>
+          <name>CDH Releases Repository</name>
+          <snapshots>
+            <enabled>false</enabled>
+          </snapshots>
+        </repository>
+        <repository>
+          <id>cdh.snapshots.repo</id>
+          <url>https://repository.cloudera.com/content/repositories/snapshots</url>
+          <name>CDH Snapshots Repository</name>
+          <snapshots>
+            <enabled>true</enabled>
+          </snapshots>
+        </repository>
+      </repositories>
+    </profile>
+    <!-- Similar logic to allow us to skip compilation/tests when run -->
+    <!-- via do-release-build or packaging scripts, since we're already -->
+    <!-- compiling via direct ant calls. -->
+    <profile>
+      <id>non.release.build</id>
+      <activation>
+        <activeByDefault>false</activeByDefault>
+        <property>
+          <name>not.cdh.release.build</name>
+          <value>!false</value>
+        </property>
+      </activation>
+      <build>
+        <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-antrun-plugin</artifactId>
+            <inherited>false</inherited>
+            <executions>
+              <execution>
+                <id>clean</id>
+                <configuration>
+                  <target>
+                    <exec executable="${ant.cmd}" dir="${basedir}" failonerror="true">
+                      <arg value="clean"/>
+                      <arg value="-Dcdh.maven=true"/>
+                      <arg value="-Dreactor.repo=file://${maven.repo.local}"/>
+                      <arg value="-Divy.cache.dir=${ivy.cache.dir}"/>
+                    </exec>
+                  </target>
+                </configuration>
+                <goals>
+                  <goal>run</goal>
+                </goals>
+                <phase>clean</phase>
+              </execution>
+              <execution>
+                <id>compile</id>
+                <configuration>
+                  <target>
+                    <exec executable="${ant.cmd}" dir="${basedir}" failonerror="true">
+                      <arg value="jar"/>
+                      <arg value="-Dcdh.maven=true"/>
+                      <arg value="-Dreactor.repo=file://${maven.repo.local}"/>
+                      <arg value="-Divy.cache.dir=${ivy.cache.dir}"/>
+                    </exec>
+                  </target>
+                </configuration>
+                <goals>
+                  <goal>run</goal>
+                </goals>
+                <phase>compile</phase>
+              </execution>
+              <execution>
+                <id>test</id>
+                <configuration>
+                  <target unless="${skipTests}">
+                    <exec executable="${ant.cmd}" dir="${basedir}" failonerror="true">
+                      <arg value="test"/>
+                      <arg value="-Dcdh.maven=true"/>
+                      <arg value="-Dreactor.repo=file://${maven.repo.local}"/>
+                      <arg value="-Divy.cache.dir=${ivy.cache.dir}"/>
+                    </exec>
+                  </target>
+                </configuration>
+                <goals>
+                  <goal>run</goal>
+                </goals>
+                <phase>test</phase>
+              </execution>
+            </executions>
+          </plugin>
+        </plugins>
+      </build>
+    </profile>
+  </profiles>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>com.cloudera.kitchen</groupId>
+        <artifactId>maven-deps-to-props-plugin</artifactId>
+        <executions>
+          <execution>
+            <id>cdh.build.properties</id>
+            <configuration>
+              <templateFile>${basedir}/cloudera/maven-packaging/templates/cdh.build.template</templateFile>
+              <targetFile>${basedir}/cdh.build.properties</targetFile>
+            </configuration>
+            <goals>
+              <goal>generate</goal>
+            </goals>
+            <phase>process-resources</phase>
+          </execution>
+        </executions>
+      </plugin>
+
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/do-release-build b/cloudera/do-release-build
index c84b9e2..9c2438c 100644
--- a/cloudera/do-release-build
+++ b/cloudera/do-release-build
@@ -11,7 +11,14 @@ RELEASE_DIR=$BIN_DIR/..
 
 cd $RELEASE_DIR
 
+ant init-cdh
+
 mkdir -p build/.ivy
 ant $EXTRA_ANT_FLAGS \
+  -propertyfile cdh.build.properties \
   -propertyfile cloudera/build.properties \
   tar
+
+# Call Maven build for install/deploy of artifacts
+cd $BIN_DIR/maven-packaging
+mvn -Dnot.cdh.release.build=false install $DO_MAVEN_DEPLOY
diff --git a/cloudera/maven-packaging/hive-anttasks/pom.xml b/cloudera/maven-packaging/hive-anttasks/pom.xml
new file mode 100644
index 0000000..3deee06
--- /dev/null
+++ b/cloudera/maven-packaging/hive-anttasks/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-anttasks</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive anttasks</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/anttasks/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-cli/pom.xml b/cloudera/maven-packaging/hive-cli/pom.xml
new file mode 100644
index 0000000..f3db397
--- /dev/null
+++ b/cloudera/maven-packaging/hive-cli/pom.xml
@@ -0,0 +1,112 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-cli</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive cli</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-contrib</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-anttasks</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-exec</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-hwi</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-jdbc</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-metastore</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-serde</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-service</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-shims</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/cli/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-common/pom.xml b/cloudera/maven-packaging/hive-common/pom.xml
new file mode 100644
index 0000000..60f3060
--- /dev/null
+++ b/cloudera/maven-packaging/hive-common/pom.xml
@@ -0,0 +1,176 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   commonutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-common</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive common</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-cli</groupId>
+      <artifactId>commons-cli</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.apache.thrift</groupId>
+      <artifactId>libfb303</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.apache.thrift</groupId>
+      <artifactId>libthrift</artifactId>
+      <version>0.5.0-cdh</version>
+    </dependency>
+
+    <dependency>
+      <groupId>org.json</groupId>
+      <artifactId>json</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>javax.jdo</groupId>
+      <artifactId>jdo2-api</artifactId>
+    </dependency>
+
+
+    <dependency>
+      <groupId>org.antlr</groupId>
+      <artifactId>antlr-runtime</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>asm</groupId>
+      <artifactId>asm</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-codec</groupId>
+      <artifactId>commons-codec</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-collections</groupId>
+      <artifactId>commons-collections</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-lang</groupId>
+      <artifactId>commons-lang</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-logging</groupId>
+      <artifactId>commons-logging</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>commons-logging</groupId>
+      <artifactId>commons-logging-api</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.datanucleus</groupId>
+      <artifactId>datanucleus-core</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.datanucleus</groupId>
+      <artifactId>datanucleus-enhancer</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.datanucleus</groupId>
+      <artifactId>datanucleus-rdbms</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.apache.derby</groupId>
+      <artifactId>derby</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>jline</groupId>
+      <artifactId>jline</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>junit</groupId>
+      <artifactId>junit</artifactId>
+      <scope>test</scope>
+    </dependency>
+
+    <dependency>
+      <groupId>log4j</groupId>
+      <artifactId>log4j</artifactId>
+    </dependency>
+
+    <dependency>
+      <groupId>org.apache.velocity</groupId>
+      <artifactId>velocity</artifactId>
+    </dependency>
+
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/common/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-contrib/pom.xml b/cloudera/maven-packaging/hive-contrib/pom.xml
new file mode 100644
index 0000000..ac32d6f
--- /dev/null
+++ b/cloudera/maven-packaging/hive-contrib/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-contrib</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive contrib</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/contrib/hive_contrib.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-exec/pom.xml b/cloudera/maven-packaging/hive-exec/pom.xml
new file mode 100644
index 0000000..c32fd98
--- /dev/null
+++ b/cloudera/maven-packaging/hive-exec/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   executor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-exec</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive exec</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/ql/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-hwi/pom.xml b/cloudera/maven-packaging/hive-hwi/pom.xml
new file mode 100644
index 0000000..cde151c
--- /dev/null
+++ b/cloudera/maven-packaging/hive-hwi/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   hwiutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-hwi</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive hwi</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/hwi/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-jdbc/pom.xml b/cloudera/maven-packaging/hive-jdbc/pom.xml
new file mode 100644
index 0000000..ed06ad5
--- /dev/null
+++ b/cloudera/maven-packaging/hive-jdbc/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   jdbcutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-jdbc</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive jdbc</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/jdbc/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-metastore/pom.xml b/cloudera/maven-packaging/hive-metastore/pom.xml
new file mode 100644
index 0000000..a843f96
--- /dev/null
+++ b/cloudera/maven-packaging/hive-metastore/pom.xml
@@ -0,0 +1,77 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   metastoreutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-metastore</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive metastore</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/metastore/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-serde/pom.xml b/cloudera/maven-packaging/hive-serde/pom.xml
new file mode 100644
index 0000000..489f7c3
--- /dev/null
+++ b/cloudera/maven-packaging/hive-serde/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   serdeutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-serde</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive serde</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/serde/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-service/pom.xml b/cloudera/maven-packaging/hive-service/pom.xml
new file mode 100644
index 0000000..371955c
--- /dev/null
+++ b/cloudera/maven-packaging/hive-service/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   serviceutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-service</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive service</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/service/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/hive-shims/pom.xml b/cloudera/maven-packaging/hive-shims/pom.xml
new file mode 100644
index 0000000..a730211
--- /dev/null
+++ b/cloudera/maven-packaging/hive-shims/pom.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   shimsutor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>hive-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>org.apache.hadoop.hive</groupId>
+  <artifactId>hive-shims</artifactId>
+  <version>0.6.0-CDH3B4-SNAPSHOT</version>
+  <packaging>jar</packaging>
+
+  <name>Hive shims</name>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hive-ant</artifactId>
+      <type>pom</type>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop.hive</groupId>
+      <artifactId>hive-common</artifactId>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <inherited>false</inherited>
+        <executions>
+          <execution>
+            <id>compile</id>
+            <configuration>
+              <target>
+                <copy file="${basedir}/../../../build/shims/${project.artifactId}-${project.version}.jar"
+                      tofile="${basedir}/target/${project.artifactId}-${project.version}.jar"/>
+                <unzip src="${basedir}/target/${project.artifactId}-${project.version}.jar"
+                       dest="${basedir}/target/classes"/>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+            <phase>compile</phase>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/pom.xml b/cloudera/maven-packaging/pom.xml
new file mode 100644
index 0000000..ba2e82b
--- /dev/null
+++ b/cloudera/maven-packaging/pom.xml
@@ -0,0 +1,80 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+<project>
+  <modelVersion>4.0.0</modelVersion>
+
+  <parent>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>cdh-root</artifactId>
+    <version>3.0-beta-4-SNAPSHOT</version>
+  </parent>
+
+  <groupId>com.cloudera.cdh</groupId>
+  <artifactId>hive-root</artifactId>
+  <version>3.0-beta-4-SNAPSHOT</version>
+  <packaging>pom</packaging>
+
+  <name>CDH Hive root</name>
+
+  <modules>
+    <module>../../cloudera-pom.xml</module>
+    <module>hive-anttasks</module>
+    <module>hive-cli</module>
+    <module>hive-common</module>
+    <module>hive-contrib</module>
+    <module>hive-exec</module>
+    <module>hive-hwi</module>
+    <module>hive-jdbc</module>
+    <module>hive-metastore</module>
+    <module>hive-serde</module>
+    <module>hive-service</module>
+    <module>hive-shims</module>
+  </modules>
+
+  <dependencies>
+    <dependency>
+      <groupId>com.cloudera.cdh</groupId>
+      <artifactId>hadoop-root</artifactId>
+      <type>pom</type>
+    </dependency>
+  </dependencies>
+
+  <dependencyManagement>
+    <dependencies>
+      <dependency>
+        <groupId>org.apache.thrift</groupId>
+        <artifactId>libthrift</artifactId>
+        <version>0.5.0-cdh</version>
+      </dependency>
+    </dependencies>
+  </dependencyManagement>
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-jar-plugin</artifactId>
+        <configuration>
+          <archive>
+            <manifestFile>target/classes/META-INF/MANIFEST.MF</manifestFile>
+          </archive>
+        </configuration>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/cloudera/maven-packaging/templates/cdh.build.template b/cloudera/maven-packaging/templates/cdh.build.template
new file mode 100644
index 0000000..a6f9e3d
--- /dev/null
+++ b/cloudera/maven-packaging/templates/cdh.build.template
@@ -0,0 +1,6 @@
+# These are for our dependency on Hadoop.
+hadoop.dep.org=org.apache.hadoop
+hadoop.dep.name=hadoop-tarball
+hadoop.dep.artifact=hadoop-tarball
+hadoop.version=org.apache.hadoop:hadoop-core.version
+reactor.repo=https://repository.cloudera.com/content/repositories/snapshots
diff --git a/cloudera/maven-packaging/templates/libraries.template b/cloudera/maven-packaging/templates/libraries.template
new file mode 100644
index 0000000..f84db05
--- /dev/null
+++ b/cloudera/maven-packaging/templates/libraries.template
@@ -0,0 +1,36 @@
+#   Licensed under the Apache License, Version 2.0 (the "License");
+#   you may not use this file except in compliance with the License.
+#   You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#   Unless required by applicable law or agreed to in writing, software
+#   distributed under the License is distributed on an "AS IS" BASIS,
+#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#   See the License for the specific language governing permissions and
+#   limitations under the License.
+
+#This properties file lists the versions of the various artifacts used by pig and components.
+#It drives ivy and the generation of a maven POM
+
+#These are the versions of our dependencies (in alphabetical order)
+#??? apacheant.version=1.7.1
+apacheant.version=1.7.1
+ant-task.version=2.0.10
+antlr-runtime.version=org.antlr:antlr-runtime:version
+checkstyle.version=checkstyle:checkstyle.version
+commons-cli.version=commons-cli:commons-cli.version
+commons-codec.version=commons-codec:commons-codec.version
+commons-collections.version=commons-collections:commons-collections.version
+commons-lang.version=commons-lang:commons-lang.version
+commons-logging.version=commons-logging:commons-logging.version
+commons-logging-api.version=commons-logging:commons-logging-api.version
+
+jdom.version=org.jdom:jdom.version
+ivy.version=org.apache.ivy:ivy.version
+log4j.version=log4j:log4j.version
+
+slf4j-api.version=1.6.1
+slf4j-log4j12.version=1.6.1
+thrift.version=0.5.0
+thrift-fb303.version=0.5.0
diff --git a/common/ivy.xml b/common/ivy.xml
index bee3bf0..adcbdbe 100644
--- a/common/ivy.xml
+++ b/common/ivy.xml
@@ -23,8 +23,8 @@
       </description>
     </info>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
 </ivy-module>
diff --git a/contrib/ivy.xml b/contrib/ivy.xml
index 194b8b2..d20b40c 100644
--- a/contrib/ivy.xml
+++ b/contrib/ivy.xml
@@ -24,8 +24,8 @@
     </info>
 
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
 </ivy-module>
diff --git a/hbase-handler/ivy.xml b/hbase-handler/ivy.xml
index 34f5685..ef03a12 100644
--- a/hbase-handler/ivy.xml
+++ b/hbase-handler/ivy.xml
@@ -24,8 +24,8 @@
     </info>
 
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
 </ivy-module>
diff --git a/hwi/ivy.xml b/hwi/ivy.xml
index f8e608f..b2e8462 100644
--- a/hwi/ivy.xml
+++ b/hwi/ivy.xml
@@ -24,8 +24,8 @@
     </info>
 
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency>
     </dependencies>
 </ivy-module>
diff --git a/ivy/ivysettings.xml b/ivy/ivysettings.xml
index 9e8dfe6..cf58735 100644
--- a/ivy/ivysettings.xml
+++ b/ivy/ivysettings.xml
@@ -43,6 +43,15 @@
       <artifact pattern="${hadoop.mirror}/hadoop/core/[artifact]-[revision]/[artifact]-[revision].[ext]" />
     </url>
 
+    <!-- CDH build repo, the pattern attribute handles SNAPSHOT artifacts -->
+    <ibiblio name="reactor-repo" root="${reactor.repo}"
+             m2compatible="true"
+             checkmodified="true"/>
+    <ibiblio name="cloudera-releases" m2compatible="true"
+             root="https://repository.cloudera.com/content/repositories/releases" checkmodified="true"/>
+    <ibiblio name="cloudera-snapshots" m2compatible="true"
+             root="https://repository.cloudera.com/content/repositories/snapshots" checkmodified="true"/>
+
     <ibiblio name="maven2" root="${repo.maven.org}" pattern="${maven2.pattern.ext}" m2compatible="true"/>
     <ibiblio name="apache-snapshot" root="${snapshot.apache.org}" m2compatible="true"
         checkmodified="true" changingPattern=".*SNAPSHOT"/>
@@ -57,17 +66,23 @@
     </filesystem>
 
     <chain name="default" dual="true" checkmodified="true" changingPattern=".*SNAPSHOT">
+      <resolver ref="reactor-repo"/>
       <resolver ref="hadoop-source"/>
       <resolver ref="apache-snapshot"/>
       <resolver ref="maven2"/>
       <resolver ref="datanucleus-repo"/>
+      <resolver ref="cloudera-releases" />
+      <resolver ref="cloudera-snapshots" />
     </chain>
 
     <chain name="internal" dual="true">
+      <resolver ref="reactor-repo"/>
       <resolver ref="fs"/>
       <resolver ref="apache-snapshot"/>
       <resolver ref="maven2"/>
       <resolver ref="datanucleus-repo"/>
+      <resolver ref="cloudera-releases" />
+      <resolver ref="cloudera-snapshots" />
     </chain>
 
     <chain name="external">
diff --git a/metastore/ivy.xml b/metastore/ivy.xml
index 83218fc..1f90df7 100644
--- a/metastore/ivy.xml
+++ b/metastore/ivy.xml
@@ -23,8 +23,8 @@
       </description>
     </info>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency>
 	<dependency org="commons-dbcp" name="commons-dbcp" rev="${commons-dbcp.version}">
           <exclude module="commons-pool" />
diff --git a/ql/ivy.xml b/ql/ivy.xml
index 99f3786..e80d3d6 100644
--- a/ql/ivy.xml
+++ b/ql/ivy.xml
@@ -23,8 +23,8 @@
       </description>
     </info>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency>
         <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
         <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"/>
diff --git a/serde/ivy.xml b/serde/ivy.xml
index d6c836a..03d631b 100644
--- a/serde/ivy.xml
+++ b/serde/ivy.xml
@@ -23,8 +23,8 @@
       </description>
     </info>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version.ant-internal}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency>
         <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
         <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"/>
diff --git a/shims/build.xml b/shims/build.xml
index 9dadc8a..e0d3cb6 100644
--- a/shims/build.xml
+++ b/shims/build.xml
@@ -63,7 +63,7 @@ to call at top-level: ant deploy-contrib compile-core-test
       <param name="hadoop.version.ant-internal" value="${hadoop.version}" />
     </antcall>
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
-      <param name="hadoop.version.ant-internal" value="${hadoop.security.version}" />
+      <param name="hadoop.version.ant-internal" value="${hadoop.version}" />
       <param name="hadoop.version.ant-internal.prefix" value="0.20S" />
     </antcall>
     <getversionpref property="hadoop.version.ant-internal.prefix" input="${hadoop.version}" />
diff --git a/shims/ivy.xml b/shims/ivy.xml
index a94ac1f..62fe17a 100644
--- a/shims/ivy.xml
+++ b/shims/ivy.xml
@@ -27,9 +27,8 @@
         <dependency org="hadoop" name="core" rev="${hadoop.version}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
-        <dependency org="hadoop" name="core" rev="${hadoop.security.version}">
-          <artifact name="hadoop" type="source" ext="tar.gz"
-            url="${hadoop.security.url}" />
+        <dependency org="${hadoop.dep.org}" name="${hadoop.dep.name}" rev="${hadoop.version}">
+          <artifact name="${hadoop.dep.artifact}" type="source" ext="tar.gz"/>
         </dependency> 
         <conflict manager="all" />
     </dependencies>
-- 
1.7.0.4

